<!doctype html>
<html>
<head>
  <title>SPRING BOOT API MySQL AJAX jQuery CRUD</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  

<style>
    .input-group {
      margin: 10px 0px 10px 0px;
    }
    .input-group label {
      display: block;
      text-align: left;
      margin: 3px;
    }
    .input-group input {
      height: 30px;
      width: 300px;
      padding: 5px 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid gray;
    }
    .btn {
      padding: 10px;
      font-size: 15px;
      color: white;
      background: #5F9EA0;
      border: none;
      border-radius: 5px;
    }
  </style>
  <script type="text/javascript">
    $(document).ready(function() {

      $('#logout').click(function(){
        $.cookie('token', null)
        $(location).prop('href', '/')
      })

      $.ajaxSetup({
        headers : {
          'Authorization' : 'Bearer ' + $.cookie('token'),
        }
      });

      $('#deleteAccount').click(function(){
        $.ajax({
          type: "DELETE",
          contentType: "application/json; charset=utf-8",
          url: "/users/deleteOwnAccount",
          cache: false,
          success: function(result) {
            alert('Delete account');
            $.cookie('token', null)
            $(location).prop('href', '/')
          },
          error: function(err) {
            alert(err);
          }
        });
      })


      $.getJSON('/api/booksByUser', function(json) {
        var tr=[];
        for (var i = 0; i < json.length; i++) {
          var email = json[i].users != null ? json[i].users.email : '';

          tr.push('<tr>');
          tr.push('<td>' + json[i].id + '</td>');
          tr.push('<td>' + json[i].name + '</td>');
          tr.push('<td>' + json[i].status + '</td>');
          tr.push('<td>' + email + '</td>');
          tr.push('</tr>');
        }
        $('table').append($(tr.join('')));
      });
    });
  </script>
</head>
<body>

<h2>Book Management</h2>

<p/>

<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>Id</th>
    <th>Name</th>
    <th>Status</th>
    <th>Borrowed By</th>
  </tr>
</table>

<input style="margin-top: 30px" id="deleteAccount" class="btn" type="submit" value="Delete Account">

<input style="margin-top: 30px" id="logout" class="btn" type="submit" value="Logout">



</body>
</html>