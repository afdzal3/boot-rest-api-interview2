<!doctype html>
<html>
<head>
  <title>PHP REST API MySQL AJAX jQuery CRUD</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <style>
    .input-group {
      margin: 10px 0px 10px 0px;
    }
    .input-group label {
      display: block;
      text-align: left;
      margin: 3px;
    }
    .input-group input {
      height: 30px;
      width: 300px;
      padding: 5px 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid gray;
    }
    .btn {
      padding: 10px;
      font-size: 15px;
      color: white;
      background: #5F9EA0;
      border: none;
      border-radius: 5px;
    }
  </style>
  <script type="text/javascript">
    $(document).ready(function() {
      $.getJSON('/api/books', function(json) {
        var tr=[];
        for (var i = 0; i < json.length; i++) {
          tr.push('<tr>');
          tr.push('<td>' + json[i].id + '</td>');
          tr.push('<td>' + json[i].name + '</td>');
          tr.push('<td>' + json[i].status + '</td>');
          tr.push('<td><button class=\'edit\'>Edit</button>&nbsp;&nbsp;<button class=\'delete\' id=' + json[i].id + '>Delete</button></td>');
          tr.push('</tr>');
        }
        $('table').append($(tr.join('')));
      });

      $(document).delegate('#addNew', 'click', function(event) {
        event.preventDefault();

        var name = $('#name').val();
        var status = $('#status').val();

        if(name == null || name == "") {
          alert("Company Name is required");
          return;
        }

        $.ajax({
          type: "POST",
          contentType: "application/json; charset=utf-8",
          url: "/api/books",
          data: JSON.stringify({'name': name, 'status': status}),
          cache: false,
          success: function(result) {
            alert('Company added successfully');
            location.reload(true);
          },
          error: function(err) {
            alert(err);
          }
        });
      });

      $(document).delegate('.delete', 'click', function() {
        if (confirm('Do you really want to delete record?')) {
          var id = $(this).attr('id');
          var parent = $(this).parent().parent();
          $.ajax({
            type: "DELETE",
            url: "/api/books/" + id,
            cache: false,
            success: function() {
              parent.fadeOut('slow', function() {
                $(this).remove();
              });
              location.reload(true)
            },
            error: function() {
              alert('Error deleting record');
            }
          });
        }
      });

      $(document).delegate('.edit', 'click', function() {
        // console.log("test")
        var parent = $(this).parent().parent();

        var id = parent.children("td:nth-child(1)");
        var name = parent.children("td:nth-child(2)");
        var status = parent.children("td:nth-child(3)");
        var buttons = parent.children("td:nth-child(4)");

        name.html("<input type='text' id='txtName' value='" + name.html() + "'/>");
        status.html("<input type='checkbox' id='txtStatus' checked value='" + 'AVAILABLE' + "'/>");

        buttons.html("<button id='save'>Save</button>&nbsp;&nbsp;<button class='delete' id='" + id.html() + "'>Delete</button>");
      });

      $(document).delegate('#save', 'click', function() {
        var parent = $(this).parent().parent();

        var id = parent.children("td:nth-child(1)");
        var name = parent.children("td:nth-child(2)");
        var status = parent.children("td:nth-child(3)");
        var buttons = parent.children("td:nth-child(4)");

        console.log(status.children("input[type=checkbox]").val())
        var borrowed = 'AVAILABLE';
        if ($('input[type=checkbox]').is(":checked"))
        {
          borrowed = 'BORROWED';
        }

        $.ajax({
          type: "PUT",
          contentType: "application/json; charset=utf-8",
          url: "/api/books/" + id.html(),
          data: JSON.stringify({'id' : id.html(), 'name' : name.children("input[type=text]").val(), 'status' : status.children("input[type=text]").val()}),
          cache: false,
          success: function() {
            name.html(name.children("input[type=text]").val());
            buttons.html("<button class='edit' id='" + id.html() + "'>Edit</button>&nbsp;&nbsp;<button class='delete' id='" + id.html() + "'>Delete</button>");
          },
          error: function() {
            alert('Error updating record');
          }
        });
      });

    });
  </script>
</head>
<body>

<h2>Book Management</h2>

<h3>Add a New Book</h3>
<div class="input-group">
  <label>Book Name</label>
  <input type="text" id="name" name="name" value="">

  <label>Book Status</label>
  <input type="text" id="status" name="status" value="">
</div>
<div class="input-group">
  <button class="btn" type="button" id="addNew">Save</button>
</div>

<p/>

<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>Id</th>
    <th>Name</th>
    <th>Status</th>
    <th>Actions</th>
  </tr>
</table>

</body>
</html>